<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Tuthut</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <link rel="author" type="text/html" href="https://plus.google.com/100325991024054712503">
        <meta name="author" content="Muaz Khan">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" />
        <style>
            * { -webkit-user-select: none; }

            html { background: #eee; }

            body {
                font-family: "Inconsolata", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", monospace;
                font-size: 1.2em;
                line-height: 1.2em;
                margin: 0;
            }

            body {
                background: #fff;
                border: 1px solid;
                border-color: #ddd #aaa #aaa #ddd;
                border-radius: 5px;
                margin: .5em auto 0 auto;
                padding: .8em;
                padding-top: 0;
            }

            h1, h2 {
                border-bottom: 1px solid black;
                display: inline;
                font-weight: normal;
                line-height: 36px;
                padding: 0 0 3px 0;
            }

            h1 {
                background: rgb(238, 238, 238);
                border-bottom-width: 2px;
                display: block;
                margin-top: 0;
                padding: .3em;
                text-align: center;
            }

            button {
                -moz-border-radius: 3px;
                -moz-transition: none;
                -webkit-transition: none;
                background: #0370ea;
                background: -moz-linear-gradient(top, #008dfd 0, #0370ea 100%);
                background: -webkit-linear-gradient(top, #008dfd 0, #0370ea 100%);
                border: 1px solid #076bd2;
                border-radius: 3px;
                color: #fff;
                display: inline-block;
                font-family: inherit;
                font-size: .8em;
                line-height: 1.3;
                padding: 5px 12px;
                text-align: center;
                text-shadow: 1px 1px 1px #076bd2;
            }

            button:hover { background: rgb(9, 147, 240); }

            button:active { background: rgb(10, 118, 190); }

            button[disabled] {
                background: none;
                border: 1px solid rgb(187, 181, 181);
                color: gray;
                text-shadow: none;
            }

            footer { text-align: center; }

            code {
                color: rgb(204, 14, 14);
                font-family: inherit;
            }

            audio, video { vertical-align: bottom; }

            pre {
                border-left: 2px solid red;
                margin-left: 2em;
                padding-left: 1em;
            }

            a {
                color: #2844FA;
                text-decoration: none;
            }

            a:hover, a:focus { color: #1B29A4; }

            a:active { color: #000; }

            :-moz-any-link:focus {
                border: 0;
                color: #000;
            }

            ::selection { background: #ccc; }

            ::-moz-selection { background: #ccc; }

            input {
                font-size: .8em;
                text-align: center;
                width: 10em;
            }

            input, textarea { -webkit-user-select: initial; }

            label {
                display: inline-block;
                width: 8em;
            }

            pre strong {
                color: red;
                font-weight: normal;
            }
        </style>
        <script src="https://www.webrtc-experiment.com/RecordRTC.js"> </script>
    </head>
    <body>
       
    <video id="preview" controls style="border: 1px solid rgb(15, 158, 238); height: 240px; width: 320px;"></video> <hr />

	<button id="record">Record</button>
	<button id="stop" disabled>Stop</button>

<br>
    Tag 1: <input id= 'tag1' type="text" name="tag1" value=""><br>
    Tag 2: <input id="tag2" type="text" name="tag2" value=""><br>
    Tag 3: <input id='tag3' type="text" name="tag3" value=""><br>
    Jaar: <input id='year' type="date" name="jaar"><br>
    Personen: <input id='characters' type="text" name="personen"><br>
    Locatie: <input id='setting' type="text" name="locatie"><br>
    Verdrietig/Blij <input type="range" value="3" id="emotion" min="1" max="5" style="position:absolute; left:250px"> <br>
    Interessant/Vermakelijk <input type="range" value="3" id="amusing" min="1" max="5" style="position:absolute; left:250px"> <br>
    Ongelukkig/Gelukkig<input type="range" value="3" id="happiness" min="1" max="5" style="position:absolute; left:250px"> <br>
    Titel: <input id='title' type = "text" name="title" value=""><br>
    Omschrijving: <input id='description' type="text" name="description" value=""><br>
    <input type="submit" onClick="sendAll()">


<div id="container"></div>
<script>
//This Index HTML is in the recordJS folder

    function PostBlob(blob, fileType, fileName) {
        // FormData
        var formData = new FormData();
        formData.append(fileType + '-filename', fileName);
        formData.append(fileType + '-blob', blob);

        // progress-bar
        var hr = document.createElement('hr');
        container.appendChild(hr);
        var strong = document.createElement('strong');
        strong.innerHTML = fileType + ' upload progress: ';
        container.appendChild(strong);
        var progress = document.createElement('progress');
        container.appendChild(progress);

        // POST the Blob
        xhr('save.php', formData, progress, function(fileURL) {
            container.appendChild(document.createElement('hr'));
            var mediaElement = document.createElement(fileType);
            mediaElement.src = location.href + fileURL;
            mediaElement.controls = true;
            container.appendChild(mediaElement);
            mediaElement.play();

            progress.parentNode.removeChild(progress);
            strong.parentNode.removeChild(strong);
            hr.parentNode.removeChild(hr);
        });
    }

    var record = document.getElementById('record');
    var stop = document.getElementById('stop');

    var audio = document.querySelector('audio');

    var recordVideo = document.getElementById('record-video');
    var preview = document.getElementById('preview');

    var container = document.getElementById('container');

    var recordAudio, recordVideo;
    record.onclick = function() {
        record.disabled = true;
        var video_constraints = {
            mandatory: { },
            optional: []
        };
        navigator.getUserMedia({
                audio: true,
                video: video_constraints
            }, function(stream) {
                preview.src = window.URL.createObjectURL(stream);
                preview.play();

				// var legalBufferValues = [256, 512, 1024, 2048, 4096, 8192, 16384];
				// sample-rates in at least the range 22050 to 96000.
                recordAudio = RecordRTC(stream, {
					//bufferSize: 16384,
					//sampleRate: 45000
				});
				
                recordVideo = RecordRTC(stream, {
                    type: 'video'
                });

                recordAudio.startRecording();
                recordVideo.startRecording();

                stop.disabled = false;
            });
    };

    var fileName;
    stop.onclick = function() {
        record.disabled = false;
        stop.disabled = true;
 		
		var date = new Date().getTime();

		console.log(date);
        fileName = date;
		
        recordAudio.stopRecording();
        PostBlob(recordAudio.getBlob(), 'audio', fileName + '.wav');

        recordVideo.stopRecording();
        PostBlob(recordVideo.getBlob(), 'video', fileName + '.webm');
		
        preview.src = '';
		
		window.filename = fileName;
    };

    function xhr(url, data, progress, callback) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200) {
                callback(request.responseText);
            }
        };

        request.onprogress = function(e) {
            if (progress) progress.value = e.loaded;
        };
        request.open('POST', url);
        request.send(data);
    }

    
</script>

<script src="jquery-1.10.1.min.js"></script>
<script>

function sendAll(){
	var videosource = window.filename; //document.getElementById('videosource').value;	//string
	var audiosource = window.filename; //string
	var thumbnailsource = "test"; //document.getElementById('thumbnailsource').value;	//string
	var tag1 = document.getElementById('tag1').value;	//string
	var tag2 = document.getElementById('tag2').value;	//string
	var tag3 = document.getElementById('tag3').value;	//string
	var year = document.getElementById('year').value;	//int (1920-2010)
	var setting = document.getElementById('setting').value;	//string
	var character = document.getElementById('characters').value;	//string
	var emotion = document.getElementById('emotion').value;	 //int (1-5)
	var happiness = document.getElementById('happiness').value;	 //int (1-5)
	var amusing = document.getElementById('amusing').value;	//int (1-5)
	var title = document.getElementById('title').value; //string
	var description = document.getElementById('description').value; //string

	var request = $.ajax({
		url: 'savevideo.php?tag1=' +tag1+ '&tag2=' +tag2+ '&tag3=' +tag3 +'&setting=' +setting +'&characters=' +character +'&year=' +year +'&emotion=' +emotion +'&happiness=' +happiness +'&amusing=' +amusing +'&videosource=' +videosource+ '&thumbnailsource=' +thumbnailsource +'&audiosource=' +audiosource + '&title=' +title +'&description=' +description,	
		type : 'POST',
		dataType: 'json',
		success : function (result) {	
			//console.log(result);			
			alert(result);
		},		
	});	
	
	request.fail(function( jqXHR, textStatus ) {
	  alert( "Request failed: " + textStatus );
	});
	
	
}

</script>
        
        

        <!-- common.js is useless for you! -->
        <script src="https://www.webrtc-experiment.com/common.js"> </script>
    </body>
</html>
